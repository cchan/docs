



<p> </p>
<p><span> Final Report </span></p>

<p><span> Team Waterloop </span></p>
<p><img src="assembled_goose.png" alt="image" /></p>

<p>University of Waterloo</p>

<p>October 2017</p>

<p>This page is left blank intentionally</p>

<p>Team Waterloop would like to recognize and thank all of our sponsors<br />
put sponsors images below</p>



<h1 id="introduction">Introduction</h1>
<h2 id="our-goal">Our Goal</h2>
<p>Hyperloop is a new proposed form of high speed transportation that revolutionizes long distance travel. Traveling at Mach 1 on sheet of air in a low pressure tube, Hyperloop would make it possible to move between Toronto and Montreal in just 30 minutes.</p>
<p>In 2013, Elon Musk released a white paper discussing the technical and economic feasibilities surrounding the idea, and open-sourced the design. Musk described it as “cross between a rail gun, the Concord, and an air hockey table” <span class="citation" data-cites="Concorde_and_airhockey"></span>. The white paper can be accessed here. Since then, the Hyperloop Pod Competition, hosted by SpaceX, was announced to incentivize engineering teams around the world to research, design, develop, and deliver a functional half-scale prototype of a Hyperloop pod.</p>
<p>Waterloop is an University of Waterloo student design team. As a team in the SSDC, our primary purpose is to compete in the yearly SpaceX Hyperloop Pod Competitions. In aligning with the mission, competition pods should be designed with real-life applicability in mind. The goal of participating in the challenges set out by SpaceX is to push the development and research in the area of Hyperloop transportation. The long-term goal is to apply the knowledge gained from building a sub-scale Hyperloop competition pods to designing a real Hyperloop systems in the future.</p>
<h2 id="about-the-team">About the Team</h2>
<p>Waterloop is a team of ambitious students from the University of Waterloo who have been researching and developing a prototype Hyperloop pod since September 2015 to compete in the SpaceX Hyperloop Pod Competitions. We are one of two Canadian teams remaining in the competition and one of only 31 teams remaining from the initial 1200+ teams.</p>
<p>The team is based in Waterloo, Ontario, Canada’s largest high tech innovation hub. Our location makes it possible to access a variety of unique services, such as LOT41 Technology and Arts Campus, 3D printing from Communitech start-up Inksmith, and the Waterloo Institute for Sustainable Energy.</p>
<p>Waterloop is different than most University of Waterloo student teams in that we are comprised of a diverse set of students from a number of faculties. We have a substantial number of engineering students driving the design of pod subsystems, but we also have a number of students specializing in architecture, physics, computer science, business, and finance. We are a passionate team united with the common goal of building a pod that wins competitions and can scale up to become a feasible method of transportation in Canada.</p>
<p>We are excited to work on technology that has never existed before and which has potential to greatly improve the quality of life for people around the world. We’re very proud to be actively promoting improved transit infrastructure in Canada which can bring people together and link our local economies, while simultaneously reducing traffic, energy use, and emissions. Our goal is to create a solution that will eliminate the reliance on fossil fuel based modes of transportation for both industry and transit in a convenient and economical way. Most importantly, we wish to demonstrate feasibility of Hyperloop technology for adoption in Canada and be at the frontier of bringing Hyperloop to reality.</p>
<h3 id="team-members">Team Members</h3>
<p>list of all team members in here</p>
<h2 id="history">History</h2>
<ul>
<li><p>Summer 2015:</p>
<ul>
<li><p>Assemble the Team.</p></li>
<li><p>Officially registered as a University of Waterloo Student Engineering Team.</p></li>
</ul></li>
<li><p>Fall 2015:</p>
<ul>
<li><p>Preliminary design briefing and evaluation by SpaceX. One of the 1200 teams entering the competition.</p></li>
</ul></li>
<li><p>Winter 2016:</p>
<ul>
<li><p>Final design briefing and evaluation by SpaceX.</p></li>
<li><p>Hyperloop Design Weekend at Texas A&amp;M. One of the 31 teams around the world to advance.</p></li>
</ul></li>
<li><p>May 2016:</p>
<ul>
<li><p>Subsystem R&amp;D and feasibility analysis.</p></li>
<li><p>Granted a private workshop at the Sedra Smith Design Centre at the University of Waterloo.</p></li>
</ul></li>
<li><p>June 2016:</p>
<ul>
<li><p>Designing and building rigs for subsystem testing - air levitation, eddy current braking, operating electronics in a vacuum.</p></li>
</ul></li>
<li><p>August 2016:</p>
<ul>
<li><p>Parts sourcing.</p></li>
<li><p>Frame fabrication.</p></li>
<li><p>Construction of a low speed test track.</p></li>
<li><p>Finalizing Goose I subsystem design.</p></li>
</ul></li>
<li><p>October 2016:</p>
<ul>
<li><p>Achieved air levitation.</p></li>
<li><p>Development of embedded and communication systems.</p></li>
<li><p>Vacuum chamber testing.</p></li>
<li><p>Launching a Kickstarter campaign to supplement sponsorship.</p></li>
</ul></li>
<li><p>November 2016:</p>
<ul>
<li><p>Successfully raised CA$43,416 with 507 backers on Goose I Kickstarter campaign.</p></li>
</ul></li>
<li><p>December 2016:</p>
<ul>
<li><p>High speed performance testing</p></li>
<li><p>System optimization.</p></li>
<li><p>Reliability and safety testing.</p></li>
</ul></li>
<li><p>January 2017:</p>
<ul>
<li><p>Attending SpaceX competition with Goose I pod. (Which one?)</p></li>
</ul></li>
<li><p>February 2017:</p>
<ul>
<li><p>Analyzing feedback from the SpaceX competition.</p></li>
</ul></li>
<li><p>March 2017:</p>
<ul>
<li><p>Beginning the build of Goose II pod. Working on overall system improvements and overhaul of multiple subsystems based on feedback from competition.</p></li>
</ul></li>
<li><p>May 2017:</p>
<ul>
<li><p>Developing a brand new embedded and communication systems.</p></li>
<li><p>Completing the assembly of Magnetic Wheels for Goose II.</p></li>
<li><p>Starting Goose II shell design process.</p></li>
<li><p>Starting the final assembly of the pod.</p></li>
</ul></li>
<li><p>June 2017:</p>
<ul>
<li><p>Vibrational testing of the Goose II to find and eliminate any resonance frequencies.</p></li>
<li><p>Testing new embedded systems elements in vacuum.</p></li>
<li><p>Integrating required sensors into embedded systems.</p></li>
<li><p>Testing communication systems and data visualization on front-end.</p></li>
<li><p>Completing static and dynamic levitation tests.</p></li>
</ul></li>
<li><p>July 2017:</p>
<ul>
<li><p>Goose II unveil.</p></li>
<li><p>Beginning preparations for SpaceX Competition 2.</p></li>
<li><p>Implementing redundancy checks and safety enhancing features in software.</p></li>
<li><p>Second vibrational testing to tune shock absorption for competition.</p></li>
</ul></li>
<li><p>August 2017:</p>
<ul>
<li><p>Tuning speed controllers for Magnetic Wheels.</p></li>
<li><p>Finalizing internal wiring of the pod.</p></li>
<li><p>Completing required administrative arrangements for the competition and transportation of the pod to SpaceX headquarters in California.</p></li>
<li><p>Major Mcdonald’s run.</p></li>
<li><p>Shipping the pod to California.</p></li>
<li><p>Attending SpaceX Competition 2.</p></li>
</ul></li>
</ul>
<h1 id="design">Design</h1>
<h2 id="high-level-design-overview">High-level Design overview</h2>
<p>As part of the SpaceX competition, team Waterloop had developed a complete solution for the pod as well as the entire infrastructure build around the vehicle, excluding the competition test track, which is in the SpaceX HQ in California. The entire pod is based on six major subsystems: Electrical, Software, Levitation, Shell, Propulsion, and Brakes. Goal of Team Waterloop from the day of the team initiation is to design a complete and cost-efficient Hyperloop pod. To develop the appropriate solution, X major design challenges had to be solved in the pod design process:</p>
<ul>
<li><p>frictionless propulsion,</p></li>
<li><p>lateral stability,</p></li>
<li><p>levitation,</p></li>
<li><p>control system,</p></li>
<li><p>add more here…</p></li>
</ul>
<p>After thorough design process and the lessons learned from Goose 1 pod, team Waterloop has developed and tested a complete competition ready vehicle to be raced in the SpaceX’s Hyperloop 1-mile long test track.<br />
The pod utilizes air bearings for the levitation system, the design allows only for a minimal levitation from the ground, however eliminates most of the friction. Four air bearings are evenly spaced around the pod skis to ensure even air release and consistent levitation margin.<br />
INSERT A CAD IN HERE<br />
To support the air bearings levitation system i.e. to provide a consistent release of air the pod stores all of the compressed air reserves in two tanks located in the middle of the pod body. In addition, to storing air in air tanks, team Waterloop designed complete pneumatic circuitry that supplies the air reserves to the air skis and other pneumatic components.<br />
To ensure lateral stability and a provide pod with propulsion team Waterloop has developed magnetic wheels that are based on the principles of a Halbach array <span class="citation" data-cites="Halbach_Array"></span>.</p>
<h2 id="levitation">Levitation</h2>
<h3 id="pneumatic-circuit">Pneumatic Circuit</h3>
<h3 id="levitation-skis">Levitation Skis</h3>
<h2 id="propulsion">Propulsion</h2>
<h3 id="magnetic-wheels">Magnetic Wheels</h3>
<h3 id="emergency-drive">Emergency Drive</h3>
<h2 id="software">Software</h2>
<p>The entire software sub-system is based on three components: embedded systems, communication systems, and front-end. Embedded-systems is responsible for all of the pod’s internal communications with the sensors, low-level control of the sub-systems, and various basic safety checks. Communication-systems is responsible for the transport of information from the vehicle to the front-end to allow for live data visualization and remote control of the pod. Front-end is responsible for displaying all of the pod’s vital readings and providing an interface to control the pod while in the tube. All of the code written for the software system of the pod is available for public access at <a href="http://www.sharelatex.com">Waterloop’s Github Page</a></p>
<h3 id="embedded-systems">Embedded Systems</h3>
<h4 id="infrastructure">Infrastructure</h4>
<p>Goose II uses an Arduino Mega 2560 as the main processing unit. The decision criteria for the hardware was as follows:</p>
<ul>
<li><p>Familiar development language and environment</p></li>
<li><p>Accessible I/O pin-out</p></li>
<li><p>Support for off-the-shelf sensors and electrical components</p></li>
<li><p>Support for custom watchdog and access to non-volatile memory</p></li>
<li><p>Performance considerations</p></li>
<li><p>Ability to function in a vacuum environment</p></li>
</ul>

<p>Two boards were mainly considered as the main computing engine for the embedded systems: Arduino Mega and STM32F746ZG.</p>

<table>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Arduino Mega 2560</th>
<th style="text-align: center;">STM32F746ZG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Processor</td>
<td style="text-align: center;">ATmega2560</td>
<td style="text-align: center;">ARM® 32-bit Cortex®-M7 CPU</td>
</tr>
<tr class="even">
<td style="text-align: center;">Clock Speed</td>
<td style="text-align: center;">16 MHz</td>
<td style="text-align: center;">up to 216 MHz</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Operating Voltage</td>
<td style="text-align: center;">5 V</td>
<td style="text-align: center;">3.3 V</td>
</tr>
<tr class="even">
<td style="text-align: center;">Max Operating Temperature</td>
<td style="text-align: center;">+85 C</td>
<td style="text-align: center;">+85 C</td>
</tr>
<tr class="odd">
<td style="text-align: center;">GPIO</td>
<td style="text-align: center;">54 <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></td>
<td style="text-align: center;">Up to 144</td>
</tr>
<tr class="even">
<td style="text-align: center;">Flash Memory</td>
<td style="text-align: center;">256 KB <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></td>
<td style="text-align: center;">1 MB</td>
</tr>
</tbody>
</table>

<p>While the STM32F746ZG is a more powerful option, Arduino Mega 2560 offers easier and more familiar development environment with support for C++ and also provides an unparalleled integration with the off-the-shelf components.</p>
<p>When designing embedded system infrastructure, the team was challenged to create reusable code modules that will allow for easier transfer of knowledge. The following challenge is crucial to long-term support of the developed embedded-systems infrastructure, as Waterloop is a student design team with fairly high turnover rate of members due to factors such as mandatory co-op terms and graduation of senior students. As a result, all of the code for Arduino is written in C++14 with an extension to compile modular files into a single Arduino executable object using Platformio. By creating a modular development environment, the team is capable of reusing developed software such as custom created libraries for specific sensors installed on the pod.</p>
<h4 id="safety-measures">Safety Measures</h4>
<p>Goose II has a list of safety measures that are implemented at all levels starting from electrical circuits to the front-end controls. Embedded-systems are responsible for two major safety features:</p>
<ul>
<li><p>Watchdog - In order to avoid process blocking behaviour and work around the low performance of Arduino Mega 2560 that would result in delay of command execution or complete loss of control of the pod, team Waterloop has developed a custom watchdog for the embedded-systems. In case, when the CPU’s processing power is exhausted and it does not respond in appropriate time frame, a watchdog gets triggered that resets the Arduino.</p></li>
<li><p>Self recovery - In order to come back to a functioning state after a reset be it due to a triggered watchdog or due to a temporary loss of power, Arduino’s non-volatile memory is used to store the state of the pod at all times, which allows the pod to come back to a fully functioning state even after a complete reset of the Arduino board.</p></li>
<li><p>Command Received Check - To ensure that the commands sent from the front end have successfully been shipped to the Embedded systems and executed, Arduino generates a response message upon every command’s arrival and upon its execution.</p></li>
<li><p>Heartbeat Check - In order to check the state of interaction between front-end and Arduino, a heartbeat can be issued upon request from the front-end controls.</p></li>
</ul>
<h3 id="communication-system">Communication System</h3>
<h4 id="infrastructure-1">Infrastructure</h4>
<p>Three major design decisions had to be made in order to develop a powerful and flexible communication pipeline to transfer packets from the low-level Arduino environment to a high-level front-end. (1) Enabling wireless connectivity for Arduino. (2) Creating an advanced data transfer channel with limited Arduino capabilities. (3) Creating an abstract package that structure that allows for transfer of various data types without an overhead cost. The following are the criteria that have to be satisfied in a perfect communication pipeline design.</p>
<ul>
<li><p>Familiar development language and environment</p></li>
<li><p>Wireless data transfer from the low-level Arduino environment to a high-level front-end</p></li>
<li><p>Channel that allows for a fast and high volume transfer of data</p></li>
<li><p>Standardized message packets</p></li>
</ul>
<p>A design decision has been made to use websocket based communication for bilateral communication pipeline with low delay and high channel capacity. In addition, TCP based control system allows to monitor packages arrival.</p>
<p>Due to the lack of extra processing power in Arduino to handle high-level data transfer methods such as websockets, an external device has been added to the communication-system to take the load of data transfer form Arduino. See below for the entire diagram of the communication-system.</p>




<p>The addition of an independent processing device for data transfer allowed for modularity of the embedded and communication systems. An abstract JSON structure with custom fields for two types of communication packages, a command and a message, have been developed to further support the concept of modularity and allow for zero additional package processing by the communication pipeline software.<br />
An example of an abstract JSON command:</p>
<pre><code>{
    &quot;cmd&quot;: &quot;emg&quot;,
    &quot;val&quot;: [0]
}</code></pre>

<p>The parameter &quot;cmd&quot; describes the type of control command to be executed. The parameter &quot;val&quot; specifies the the state to be set as active. Please see <a href="#appendix:comm_messages" data-reference-type="ref" data-reference="appendix:comm_messages">1</a> for all communication pipeline commands.<br />
An example of an abstract JSON message:</p>
<pre><code>{
    &quot;time&quot;:1009,
    &quot;sensor&quot;:&quot;gyro&quot;,
    &quot;data&quot;:[-1.54875,12.19750,11.36625, 1]
}</code></pre>

<p>The parameter &quot;time&quot; describes the timestamp of the message sent from Arduino. The parameter &quot;sensor&quot; specifies the sensor which emitted the message. The parameter &quot;data&quot; specifies the data to be sent. Please see <a href="#appendix:sensor_messages" data-reference-type="ref" data-reference="appendix:sensor_messages">2</a> for all communication pipeline messages.<br />
</p>
<h4 id="features">Features</h4>
<ul>
<li><p>Blackbox - Due to a larger capacity of non-volatile memory on Raspberry PI, the feature of a blackbox has been implemented, where every command and sensor reading sent from Arduino to Raspberry PI is logged in a file.</p></li>
<li><p>Data Logging - In addition to Blackbox functionality, a separate file is generated by the pod with all of the sensor readings. Such file proved to be very useful during testing to analyze patterns in vibrations and resonance frequencies, as well as post data processing such as velocity to wheel rpm ratios.</p></li>
</ul>
<h3 id="front-end">Front end</h3>
<h3 id="software-system-integration">Software system integration</h3>
<h2 id="electrical">Electrical</h2>
<h3 id="sensors">Sensors</h3>
<h3 id="circuit">Circuit</h3>
<h2 id="brakes">Brakes</h2>
<h2 id="shell">Shell</h2>
<h1 id="testing">Testing</h1>
<h2 id="vacuum-testing">Vacuum Testing</h2>

<h1 id="appendices">Appendices</h1>
<h2 id="appendix:comm_messages">Control Communication Pipeline Packages</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Command Name</strong></th>
<th style="text-align: center;"><strong>Command Code</strong></th>
<th style="text-align: center;"><strong>Values Allowed</strong></th>
<th style="text-align: center;"><strong>Example command</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">EC Brake</td>
<td style="text-align: center;">&quot;brk&quot;</td>
<td style="text-align: center;">0 / 1</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;brk&quot;,&quot;val&quot;:[0]}</td>
</tr>
<tr class="even">
<td style="text-align: center;">Emergency</td>
<td style="text-align: center;">&quot;emg&quot;</td>
<td style="text-align: center;">0 / 1</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;emg&quot;,&quot;val&quot;:[0]}</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Speed</td>
<td style="text-align: center;">&quot;spd&quot;</td>
<td style="text-align: center;">0 - 100</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;spd&quot;,&quot;val&quot;:[50]}</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mode</td>
<td style="text-align: center;">&quot;mode&quot;</td>
<td style="text-align: center;">0 / 1 / 2</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;mode&quot;,&quot;val&quot;:[0]}</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Ball Valve</td>
<td style="text-align: center;">&quot;bv&quot;</td>
<td style="text-align: center;">0 / 1</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;bv&quot;,&quot;val&quot;:[0]}</td>
</tr>
<tr class="even">
<td style="text-align: center;">Heartbeat</td>
<td style="text-align: center;">&quot;check&quot;</td>
<td style="text-align: center;">0 / 1</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;check&quot;,&quot;val&quot;:[1]}</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Save State</td>
<td style="text-align: center;">&quot;rest&quot;</td>
<td style="text-align: center;">0 / 1</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;rest&quot;,&quot;val&quot;:[0]}</td>
</tr>
<tr class="even">
<td style="text-align: center;">Stop Pod</td>
<td style="text-align: center;">&quot;stop&quot;</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;stop&quot;,&quot;val&quot;:[0]}</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Start Pod</td>
<td style="text-align: center;">&quot;start&quot;</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">{&quot;cmd&quot;:&quot;start&quot;,&quot;val&quot;:[0]}</td>
</tr>
</tbody>
</table>
<h2 id="appendix:sensor_messages">Message Communication Pipeline Packages</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Message Type</strong></th>
<th style="text-align: center;"><strong>Example Message</strong></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Sensor</td>
<td style="text-align: center;">{&quot;time&quot;:1009,&quot;sensor&quot;:&quot;gyro&quot;,&quot;data&quot;:[-1.54875,12.19750,11.36625,1]}</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">Command Received</td>
<td style="text-align: center;">{&quot;time&quot;:2309,&quot;received&quot;:&quot;<span>&quot;cmd&quot;:&quot;emg&quot;,&quot;val&quot;:[0]</span>&quot;}</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Message</td>
<td style="text-align: center;">{&quot;time&quot;:4037,&quot;message&quot;:&quot;Setup has been called&quot;}</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>

<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>The GPIO in AT-Mega 2560 is expandable with a third-party shield<a href="#fnref1" class="footnoteBack">↩</a></p></li>
<li id="fn2"><p>256 KB of which 8 KB used by bootloader<a href="#fnref2" class="footnoteBack">↩</a></p></li>
</ol>
</section>
